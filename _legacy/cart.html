<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Cart | YourKirana</title>
  <link rel="stylesheet" href="css/style.css">
  <script defer src="js/main.js"></script>
  <script defer src="js/cart.js"></script>
  <style>
    .cart-page {
      padding: 90px 16px 40px;
      min-height: calc(100vh - 90px);
      -webkit-box-sizing: border-box;
      box-sizing: border-box;
    }
    
    .cart-page-header {
      margin-bottom: 24px;
    }
    
    .cart-page-header h1 {
      font-size: 1.75rem;
      font-weight: 800;
      margin-bottom: 8px;
      line-height: 1.2;
    }
    
    .cart-content {
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }
    
    .cart-items-list {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: vertical;
      -webkit-box-direction: normal;
      -ms-flex-direction: column;
      flex-direction: column;
      margin-bottom: 24px;
    }
    
    .cart-items-list > * + * {
      margin-top: 16px;
    }
    
    .cart-item {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      padding: 16px;
      background: #f9fafb;
      border-radius: 12px;
      border: 1px solid #f0f0f0;
      -webkit-box-sizing: border-box;
      box-sizing: border-box;
      width: 100%;
    }
    
    .cart-item-image {
      width: 60px;
      min-width: 60px;
      height: 60px;
      border-radius: 8px;
      background: white;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      -webkit-box-pack: center;
      -ms-flex-pack: center;
      justify-content: center;
      font-size: 1.5rem;
      -ms-flex-negative: 0;
      flex-shrink: 0;
      border: 1px solid #f0f0f0;
      margin-right: 12px;
    }
    
    .cart-item-details {
      -webkit-box-flex: 1;
      -ms-flex: 1;
      flex: 1;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: vertical;
      -webkit-box-direction: normal;
      -ms-flex-direction: column;
      flex-direction: column;
      min-width: 0;
    }
    
    .cart-item-name {
      font-weight: 600;
      font-size: 0.95rem;
      color: #1a1a1a;
      line-height: 1.4;
      margin-bottom: 4px;
      word-wrap: break-word;
    }
    
    .cart-item-price {
      font-weight: 700;
      color: #1a1a1a;
      font-size: 1rem;
      margin-bottom: 8px;
    }
    
    .cart-item-controls {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      margin-top: auto;
      width: 100%;
    }
    
    .cart-item-controls .quantity-control {
      margin-right: 12px;
    }
    
    .quantity-control {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 4px;
    }
    
    .quantity-btn {
      width: 32px;
      min-width: 32px;
      height: 32px;
      border: none;
      background: #f5f5f5;
      border-radius: 6px;
      cursor: pointer;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      -webkit-box-pack: center;
      -ms-flex-pack: center;
      justify-content: center;
      font-size: 1.2rem;
      font-weight: 600;
      color: #666;
      -webkit-tap-highlight-color: transparent;
      margin: 0 2px;
    }
    
    .quantity-value {
      min-width: 30px;
      text-align: center;
      font-weight: 600;
      font-size: 0.95rem;
      color: #1a1a1a;
      padding: 0 10px;
    }
    
    .remove-item {
      background: none;
      border: none;
      color: #ef4444;
      cursor: pointer;
      padding: 8px;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      -webkit-tap-highlight-color: transparent;
    }
    
    .cart-summary {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      padding: 20px;
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
      -webkit-box-sizing: border-box;
      box-sizing: border-box;
    }
    
    .summary-row {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      margin-bottom: 12px;
      font-size: 0.95rem;
    }
    
    .summary-row.total {
      font-size: 1.2rem;
      font-weight: 700;
      padding-top: 16px;
      border-top: 2px solid #e5e7eb;
      margin-top: 16px;
      color: var(--mint-700);
    }
    
    .checkout-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, var(--mint), var(--mint-700));
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      -webkit-transition: all 0.3s ease;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(54, 193, 153, 0.3);
      margin-top: 20px;
      -webkit-appearance: none;
      appearance: none;
      -webkit-tap-highlight-color: transparent;
    }
    
    .checkout-btn:active:not(:disabled) {
      -webkit-transform: scale(0.98);
      transform: scale(0.98);
      box-shadow: 0 2px 8px rgba(54, 193, 153, 0.3);
    }
    
    .checkout-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .empty-cart {
      text-align: center;
      padding: 60px 20px;
    }
    
    .empty-cart-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }
    
    .empty-cart h2 {
      font-size: 1.3rem;
      margin-bottom: 12px;
      color: #666;
    }
    
    .empty-cart p {
      color: #999;
      margin-bottom: 30px;
      font-size: 0.95rem;
    }
    
    .btn-shop {
      display: inline-block;
      padding: 12px 24px;
      background: linear-gradient(135deg, var(--mint), var(--mint-700));
      color: white;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 600;
      -webkit-transition: all 0.3s ease;
      transition: all 0.3s ease;
      -webkit-tap-highlight-color: transparent;
    }
    
    .btn-shop:active {
      -webkit-transform: scale(0.98);
      transform: scale(0.98);
    }
    
    /* Mobile first - iPhone 7 Plus and smaller */
    @media (max-width: 414px) {
      .cart-page {
        padding: 85px 12px 30px;
      }
      
      .cart-page-header h1 {
        font-size: 1.5rem;
      }
      
      .cart-item {
        padding: 12px;
      }
      
      .cart-item-image {
        width: 50px;
        min-width: 50px;
        height: 50px;
        font-size: 1.3rem;
      }
      
      .cart-summary {
        padding: 16px;
      }
    }
    
    /* Tablet and larger */
    @media (min-width: 768px) {
      .cart-page {
        padding: 100px 20px 40px;
      }
      
      .cart-page-header h1 {
        font-size: 2rem;
      }
      
      #cartGrid {
        display: -ms-grid;
        display: grid;
        -ms-grid-columns: 1fr 400px;
        grid-template-columns: 1fr 400px;
        -webkit-box-align: start;
        -ms-flex-align: start;
        align-items: start;
      }
      
      #cartGrid > *:first-child {
        margin-right: 30px;
      }
      
      .cart-summary {
        max-width: 400px;
        margin-left: auto;
        margin-right: 0;
        position: -webkit-sticky;
        position: sticky;
        top: 100px;
      }
      
      .cart-items-list {
        margin-bottom: 0;
      }
    }
    
    /* Fix for iOS Safari viewport height */
    @supports (-webkit-touch-callout: none) {
      .cart-page {
        min-height: -webkit-fill-available;
      }
    }
    
    /* Override any conflicting styles from main CSS */
    #cartPageContent .cart-item,
    #cartItemsList .cart-item {
      display: -webkit-box !important;
      display: -ms-flexbox !important;
      display: flex !important;
      -webkit-box-orient: horizontal !important;
      -webkit-box-direction: normal !important;
      -ms-flex-direction: row !important;
      flex-direction: row !important;
      width: 100% !important;
      max-width: 100% !important;
      margin: 0 !important;
    }
    
    #cartPageContent .cart-item-image,
    #cartItemsList .cart-item-image {
      width: 60px !important;
      min-width: 60px !important;
      height: 60px !important;
      margin-right: 12px !important;
    }
    
    /* Ensure cart items list doesn't use grid gap (iOS compatibility) */
    #cartItemsList {
      display: -webkit-box !important;
      display: -ms-flexbox !important;
      display: flex !important;
      -webkit-box-orient: vertical !important;
      -webkit-box-direction: normal !important;
      -ms-flex-direction: column !important;
      flex-direction: column !important;
    }
    
    /* Prevent text overflow on mobile */
    .cart-item-name {
      overflow-wrap: break-word;
      word-wrap: break-word;
      -webkit-hyphens: auto;
      -ms-hyphens: auto;
      hyphens: auto;
    }
    
    /* Better touch targets for iOS */
    .quantity-btn,
    .remove-item,
    .checkout-btn {
      -webkit-tap-highlight-color: rgba(54, 193, 153, 0.2);
      min-height: 44px;
      min-width: 44px;
    }
    
    @media (max-width: 414px) {
      #cartPageContent .cart-item-image,
      #cartItemsList .cart-item-image {
        width: 50px !important;
        min-width: 50px !important;
        height: 50px !important;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header floating-nav">
    <div class="container bar">
      <div class="logo">Your<span>Kirana</span></div>
      <nav class="nav">
        <a href="index.html">Home</a>
        <a href="categories.html">Categories</a>
        <a href="seller.html">Seller Onboarding</a>
        <a href="about-advantage.html">About & Advantage</a>
        <a href="cart.html" class="cart-trigger" id="cartTrigger">
          Cart <span class="cart-badge" id="cartBadge" style="display: none;">0</span>
        </a>
        <a href="login.html" class="nav-btn">Login</a>
        <a href="signup.html" class="nav-btn">Sign Up</a>
      </nav>
      <button class="hamb" aria-label="Menu">â˜°</button>
    </div>
  </header>

  <!-- Drawer -->
  <div class="drawer" id="drawer">
    <a href="index.html">Home</a>
    <a href="categories.html">Categories</a>
    <a href="seller.html">Seller Onboarding</a>
    <a href="about-advantage.html">About & Advantage</a>
    <a href="cart.html" class="cart-trigger" id="cartTriggerMobile">
      Cart <span class="cart-badge" id="cartBadgeMobile" style="display: none;">0</span>
    </a>
    <a href="login.html" class="nav-btn">Login</a>
    <a href="signup.html" class="nav-btn">Sign Up</a>
  </div>

  <div class="cart-page">
    <div class="cart-content">
      <div class="cart-page-header">
        <h1>Your Cart</h1>
        <p class="muted">Review your items and proceed to checkout</p>
      </div>

      <div id="cartPageContent">
        <!-- Cart items will be loaded here -->
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-wrapper">
      <div class="footer-col">
        <div class="logo">Your<span>Kirana</span></div>
        <p class="muted">Delivering essentials from local stores to your doorstep. Simple, fast, and reliable shopping experience.</p>
      </div>

      <div class="footer-col">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="categories.html">Categories</a></li>
          <li><a href="seller.html">Seller Onboarding</a></li>
          <li><a href="about-advantage.html">About & Advantage</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h4>Contact</h4>
        <ul>
          <li><a href="mailto:support@yourkirana.in">support@yourkirana.in</a></li>
          <li><a href="#">+91 99999 99999</a></li>
          <li><a href="#">Bangalore, India</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      Â© 2025 YourKirana | Nexora Solutions Private Limited â€¢ Bangalore
    </div>
  </footer>

  <script>
    // Load cart on page load
    document.addEventListener('DOMContentLoaded', () => {
      updateCartPage();
    });

    function updateCartPage() {
      let cart = [];
      try {
        const savedCart = localStorage.getItem('yk_cart') || '[]';
        cart = JSON.parse(savedCart);
        
        // Clean and validate cart
        cart = cart.filter(item => {
          return item && 
                 item.name && 
                 typeof item.name === 'string' &&
                 !isNaN(parseFloat(item.price)) && 
                 parseFloat(item.price) > 0 &&
                 !isNaN(parseInt(item.quantity)) && 
                 parseInt(item.quantity) > 0;
        }).map(item => ({
          name: String(item.name),
          price: parseFloat(item.price) || 0,
          quantity: parseInt(item.quantity) || 1
        }));
        
        // Save cleaned cart back
        localStorage.setItem('yk_cart', JSON.stringify(cart));
      } catch (error) {
        console.error('Error loading cart:', error);
        cart = [];
        localStorage.setItem('yk_cart', '[]');
      }
      
      const cartPageContent = document.getElementById('cartPageContent');
      
      // Update badges
      const totalItems = cart.reduce((total, item) => {
        const qty = parseInt(item.quantity) || 0;
        return total + qty;
      }, 0);
      const validTotalItems = isNaN(totalItems) ? 0 : Math.max(0, totalItems);
      
      const badge = document.getElementById('cartBadge');
      const badgeMobile = document.getElementById('cartBadgeMobile');
      
      if (badge) {
        badge.textContent = validTotalItems;
        badge.style.display = validTotalItems > 0 ? 'inline-flex' : 'none';
      }
      if (badgeMobile) {
        badgeMobile.textContent = validTotalItems;
        badgeMobile.style.display = validTotalItems > 0 ? 'inline-flex' : 'none';
      }

      if (cart.length === 0) {
        cartPageContent.innerHTML = `
          <div class="empty-cart">
            <div class="empty-cart-icon">ğŸ›’</div>
            <h2>Your cart is empty</h2>
            <p>Looks like you haven't added any items to your cart yet.</p>
            <a href="categories.html" class="btn-shop">Start Shopping</a>
          </div>
        `;
      } else {
        const total = cart.reduce((sum, item) => {
          const price = parseFloat(item.price) || 0;
          const quantity = parseInt(item.quantity) || 0;
          return sum + (price * quantity);
        }, 0);
        const validTotal = isNaN(total) ? 0 : total;
        
        const productIcons = {
          "Diapers Small 20pc": "ğŸ§·", "Diapers Medium 20pc": "ğŸ§·", "Diapers Large 20pc": "ğŸ§·",
          "Baby Wipes 72pc": "ğŸ§»", "Baby Soap 75g": "ğŸ§¼", "Baby Shampoo 200ml": "ğŸ§´",
          "Baby Lotion 200ml": "ğŸ§´", "Baby Oil 100ml": "ğŸ§´", "Baby Powder 200g": "ğŸ«§",
          "Feeding Bottle 250ml": "ğŸ¼", "Teether": "ğŸ ", "Rattle": "ğŸµ", "Sipper Cup": "ğŸ¥¤",
          "Rice Cereal 300g": "ğŸš", "Fruit Puree 100g": "ğŸ", "Baby Blanket": "ğŸ§£",
          "Baby Detergent 500ml": "ğŸ«§", "Diaper Rash Cream": "ğŸ§´", "Nail Scissors": "âœ‚ï¸",
          "Vitamin C 60 tablets": "ğŸŠ", "Multivitamin 30 tablets": "ğŸ’Š", "Protein Powder 1kg": "ğŸ‹ï¸â€â™‚ï¸",
          "ORS 200ml": "ğŸ’§", "Electrolyte Sachets 5pc": "âš¡", "Bandages 10pc": "ğŸ©¹",
          "First Aid Kit": "â›‘ï¸", "Thermometer": "ğŸŒ¡ï¸", "Pulse Oximeter": "ğŸ’“",
          "Hand Sanitizer 500ml": "ğŸ§´", "N95 Mask 5pc": "ğŸ˜·", "Pain Relief Spray": "ğŸ§´",
          "Cold & Flu Syrup": "ğŸ¤§", "Cough Drops 50g": "ğŸ¬", "Herbal Tea 100g": "ğŸµ",
          "Green Tea 100g": "ğŸƒ", "Apple Cider Vinegar 500ml": "ğŸ", "Chyawanprash 1kg": "ğŸŒ¿",
          "Ayurvedic Oil 100ml": "ğŸª”", "Steam Inhaler": "ğŸŒ¬ï¸",
          "Onion 1kg": "ğŸ§…", "Tomato 1kg": "ğŸ…", "Potato 1kg": "ğŸ¥”", "Carrot 500g": "ğŸ¥•",
          "Beans 500g": "ğŸ«›", "Spinach 1 bunch": "ğŸŒ¿", "Coriander 1 bunch": "ğŸŒ±",
          "Banana 1 dozen": "ğŸŒ", "Apple 1kg": "ğŸ", "Orange 1kg": "ğŸŠ", "Grapes 500g": "ğŸ‡",
          "Pomegranate 500g": "ğŸ", "Mango 1kg": "ğŸ¥­", "Papaya 1pc": "ğŸˆ", "Lemon 6pc": "ğŸ‹",
          "Cucumber 500g": "ğŸ¥’", "Capsicum 500g": "ğŸ«‘", "Garlic 250g": "ğŸ§„",
          "Ginger 250g": "ğŸ«š", "Coconut 1pc": "ğŸ¥¥"
        };
        
        function getIcon(name) {
          return productIcons[name] || "ğŸ“¦";
        }

        cartPageContent.innerHTML = `
          <div style="display: grid; grid-template-columns: 1fr; gap: 30px;" id="cartGrid">
            <div class="cart-items-list" id="cartItemsList">
              ${cart.map(item => {
                const itemName = String(item.name || 'Unknown Item');
                const itemPrice = parseFloat(item.price) || 0;
                const itemQuantity = parseInt(item.quantity) || 1;
                const safeName = itemName.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                
                return `
                <div class="cart-item">
                  <div class="cart-item-image">${getIcon(itemName)}</div>
                  <div class="cart-item-details">
                    <div class="cart-item-name">${itemName}</div>
                    <div class="cart-item-price">â‚¹ ${itemPrice.toFixed(0)}</div>
                    <div class="cart-item-controls">
                      <div class="quantity-control">
                        <button class="quantity-btn" onclick="handleQuantityChange('${safeName}', -1)">âˆ’</button>
                        <span class="quantity-value">${itemQuantity}</span>
                        <button class="quantity-btn" onclick="handleQuantityChange('${safeName}', 1)">+</button>
                      </div>
                      <button class="remove-item" onclick="handleRemove('${safeName}')">Remove</button>
                    </div>
                  </div>
                </div>
              `;
              }).join('')}
            </div>
            
            <div class="cart-summary">
              <h3 style="margin-bottom: 20px; font-size: 1.2rem;">Order Summary</h3>
              <div class="summary-row">
                <span>Subtotal (${validTotalItems} items)</span>
                <span>â‚¹ ${validTotal.toFixed(0)}</span>
              </div>
              <div class="summary-row">
                <span>Delivery Charges</span>
                <span style="color: var(--mint);">FREE</span>
              </div>
              <div class="summary-row total">
                <span>Total</span>
                <span>â‚¹ ${validTotal.toFixed(0)}</span>
              </div>
              <button class="checkout-btn" onclick="alert('Checkout functionality will be implemented soon!')">Proceed to Checkout</button>
            </div>
          </div>
        `;
      }
    }

    function handleQuantityChange(name, change) {
      if (typeof updateQuantity === 'function') {
        updateQuantity(name, change);
      } else {
        try {
          const cart = JSON.parse(localStorage.getItem('yk_cart') || '[]');
          const item = cart.find(i => i && i.name === name);
          if (item) {
            const currentQty = parseInt(item.quantity) || 0;
            const newQty = currentQty + change;
            if (newQty <= 0) {
              const index = cart.indexOf(item);
              if (index > -1) cart.splice(index, 1);
            } else {
              item.quantity = newQty;
            }
            localStorage.setItem('yk_cart', JSON.stringify(cart));
          }
        } catch (error) {
          console.error('Error updating quantity:', error);
        }
      }
      updateCartPage();
    }

    function handleRemove(name) {
      if (typeof removeFromCart === 'function') {
        removeFromCart(name);
      } else {
        try {
          const cart = JSON.parse(localStorage.getItem('yk_cart') || '[]');
          const newCart = cart.filter(item => item && item.name !== name);
          localStorage.setItem('yk_cart', JSON.stringify(newCart));
        } catch (error) {
          console.error('Error removing item:', error);
        }
      }
      updateCartPage();
    }

    // Make functions available
    window.updateCartPage = updateCartPage;
    window.handleQuantityChange = handleQuantityChange;
    window.handleRemove = handleRemove;
  </script>
</body>
</html>

